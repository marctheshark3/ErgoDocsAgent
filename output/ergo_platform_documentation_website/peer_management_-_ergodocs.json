{
  "title": "Peer Management - ErgoDocs",
  "source_url": "https://docs.ergoplatform.com/node/peer-management/",
  "summary": "A peer is identified by a pair consisting of an addr (IPv4/IPv6 address) and a port number. A peer management structure within a node can be represented as a tuple (G, B, C), where: This structure adheres to the following invariants: A penalty is represented as a tuple (descr, score), where descr describes the type of misbehavior, and score quantifies its severity. There are four categories of penalties: When a penalty is imposed, the penalized peer's information is updated in the penalty book. The penalty book maps an IP address (ip) to its current accumulated penalty score and the timestamp (ts) of the last penalty event: ip -> (score, ts). To prevent excessive penalization for transient issues, penalties of type NonDeliveryPenalty, MisbehaviorPenalty, and SpamPenalty are not applied repeatedly to the same peer within a defined safe interval (a cooldown period between penalties).",
  "keywords": [
    "peer",
    "pair",
    "addr",
    "ipv4",
    "ipv6",
    "address",
    "port",
    "number",
    "management",
    "structure",
    "node",
    "tuple",
    "invariant",
    "penalty",
    "descr",
    "score",
    "type",
    "misbehavior",
    "severity",
    "category",
    "information",
    "book",
    "timestamp",
    "event",
    "penalization",
    "issue",
    "nondeliverypenalty",
    "misbehaviorpenalty",
    "spampenalty",
    "interval",
    "period",
    "threshold",
    "blacklist",
    "duration",
    "permanentpenalty",
    "result",
    "discovery",
    "protocol",
    "source"
  ],
  "sections": [
    {
      "heading": "Definitions#",
      "content": "A peer is identified by a pair consisting of an addr (IPv4/IPv6 address) and a port number.\nA peer management structure within a node can be represented as a tuple (G, B, C), where:\nG is the set of known good peers.\nB is the set of banned peers.\nC is the set of currently connected peers.\nThis structure adheres to the following invariants:\nThe sets of good peers and banned peers are disjoint: \\(G \\cap B = \\emptyset\\).\nThe set of connected peers is always a subset of the good peers: \\(C \\subseteq G\\).\nBoth G and B are subsets of the set of all possible peers \\(\\peers\\): \\(G \\subseteq \\peers\\), \\(B \\subseteq \\peers\\)."
    },
    {
      "heading": "Peer Penalization and Blacklisting#",
      "content": "A penalty is represented as a tuple (descr, score), where descr describes the type of misbehavior, and score quantifies its severity.\nThere are four categories of penalties:\nNonDeliveryPenalty: Applied when a peer fails to deliver a requested modifier within the expected timeframe.\nMisbehaviorPenalty: Applied when a peer delivers an invalid modifier (e.g., one failing validation rules).\nSpamPenalty: Applied when a peer delivers an unsolicited modifier (one that was not requested).\nPermanentPenalty: Applied for severe protocol deviations, resulting in an immediate and permanent ban.\nWhen a penalty is imposed, the penalized peer's information is updated in the penalty book. The penalty book maps an IP address (ip) to its current accumulated penalty score and the timestamp (ts) of the last penalty event: ip -> (score, ts).\nTo prevent excessive penalization for transient issues, penalties of type NonDeliveryPenalty, MisbehaviorPenalty, and SpamPenalty are not applied repeatedly to the same peer within a defined safe interval (a cooldown period between penalties).\nWhen a peer's accumulated score reaches a predefined critical threshold, the peer is added to the blacklist. The blacklist maps a banned peer's IP address (ip) to the timestamp (ts) when the ban was initiated: ip -> ts. Peers typically remain on the blacklist for a configurable duration, after which they might be removed and potentially re-added to the set of good peers.\nApplying a PermanentPenalty, however, results in the peer being added to the blacklist indefinitely."
    },
    {
      "heading": "Peer Discovery#",
      "content": "The peer discovery protocol aims to find new potential peers from various sources and add them to the set of good peers (G). Sources for discovery can include:\nOther connected peers (exchanging peer lists).\nPredefined bootstrap nodes.\nTrusted central servers (less common in decentralized networks).\nPotentially untrusted channels like DNS seeds, IRC, Twitter, etc. (requiring careful validation)."
    }
  ],
  "qa_pairs": []
}