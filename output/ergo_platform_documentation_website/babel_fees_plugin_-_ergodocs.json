{
  "title": "Babel Fees Plugin - ErgoDocs",
  "source_url": "https://docs.ergoplatform.com/dev/protocol/tx/babel-fleet/",
  "summary": "The Babel Fees Plugin is a specialized extension for the Fleet SDK designed to simplify the process of using Babel Fees within Ergo transactions. Babel Fees is a mechanism that allows users to pay transaction fees with tokens instead of ERG, particularly beneficial for those with limited or no ERG balances. The plugin automates the complex process of token-to-ERG conversion necessary for utilizing Babel Fees. It integrates seamlessly into the Fleet SDK\u00e2\u0080\u0099s transaction framework, enabling developers to build sophisticated transactions that don't require users to have a native ERG balance for transaction fee payments. At its core, Babel Fees is an Ergo protocol feature that enables users to pay transaction fees using a variety of tokens, rather than being restricted to using ERG.",
  "keywords": [
    "babel",
    "fees",
    "plugin",
    "extension",
    "fleet",
    "process",
    "ergo",
    "transaction",
    "mechanism",
    "user",
    "token",
    "balance",
    "conversion",
    "sdk\u00e2\u0080\u0099s",
    "framework",
    "developer",
    "payment",
    "core",
    "protocol",
    "feature",
    "variety",
    "tokens",
    "contract",
    "liquidity",
    "source",
    "\u00e2\u0080\u009cbabel",
    "boxes\u00e2\u0080\u009d",
    "swap",
    "other",
    "benefit",
    "validation",
    "script",
    "generation",
    "friendly",
    "command",
    "project",
    "@fleet",
    "system",
    "requirements",
    "node.js",
    "version",
    "example",
    "babelswapplugin",
    "explanation",
    "input",
    "amount",
    "tokenid",
    "string",
    "transactionextension",
    "gettokenprice(babelbox",
    "bigint",
    "buildbabelcontract(tokenid",
    "isvalidbabelbox(box",
    "boolean",
    "extracttokenidfrombabelcontract(ergotree",
    "isbabelcontractfortokenid(ergotree",
    "container",
    "combination",
    "rate",
    "reference",
    "representation",
    "100604000e20{tokenid}0400040005000500d803d601e30004d602e4c6a70408d603e4c6a7050595e67201d804d604b2a5e4720100d605b2db63087204730000d606db6308a7d60799c1a7c17204d1968302019683050193c27204c2a7938c720501730193e4c672040408720293e4c672040505720393e4c67204060ec5a796830201929c998c7205029591b1720673028cb272067303000273047203720792720773057202",
    "replace",
    "target",
    "ergotree",
    "boxes",
    "platform",
    "snippet",
    "function",
    "blockchain",
    "guide",
    "application",
    "enhancement",
    "module",
    "export",
    "fixes",
    "dependency",
    "environment"
  ],
  "sections": [
    {
      "heading": "Babel Fees Plugin Documentation#",
      "content": "The Babel Fees Plugin is a specialized extension for the Fleet SDK designed to simplify the process of using Babel Fees within Ergo transactions. Babel Fees is a mechanism that allows users to pay transaction fees with tokens instead of ERG, particularly beneficial for those with limited or no ERG balances. The plugin automates the complex process of token-to-ERG conversion necessary for utilizing Babel Fees. It integrates seamlessly into the Fleet SDK\u00e2\u0080\u0099s transaction framework, enabling developers to build sophisticated transactions that don't require users to have a native ERG balance for transaction fee payments."
    },
    {
      "heading": "What are Babel Fees?#",
      "content": "At its core, Babel Fees is an Ergo protocol feature that enables users to pay transaction fees using a variety of tokens, rather than being restricted to using ERG. This is done by leveraging smart contracts which act as liquidity sources (called \u00e2\u0080\u009cBabel Boxes\u00e2\u0080\u009d) for token-to-ERG swaps. These contracts are set up by others who wish to provide this liquidity to users.\nBabel Fees offer key benefits:\nAccessibility: Allows users with limited or no ERG to interact with the Ergo network.\nFlexibility: Users can choose which tokens they want to use for paying fees.\nOnboarding: Makes it easier for new users to join the ecosystem."
    },
    {
      "heading": "Key Features#",
      "content": "Transaction Extension\n\nProvides a BabelSwapPlugin that seamlessly integrates with Fleet SDK's TransactionBuilder\nModifies transaction inputs and outputs to incorporate Babel Fee logic\n\n\n\nBabel Box Validation\n\nOffers utilities to validate the structure and parameters of Babel Boxes\nEnsures compliance with the Babel Fees protocol\n\n\n\nContract Script Generation\n\nIncludes functions for building and verifying Babel Fee contract scripts (ErgoTree)\n\n\n\nDeveloper-Friendly\n\nSupports ESM and CommonJS modules\nTree-shakeable design for smaller bundle sizes"
    },
    {
      "heading": "Installation#",
      "content": "To install the plugin, use the following commands in your project:\nnpm install @fleet-sdk/babel-fees-plugin\nThe core Fleet SDK is also required:\nnpm install @fleet-sdk/core\nSystem Requirements: Node.js version 18 or newer."
    },
    {
      "heading": "Usage Example: Add Babel Fees to a Transaction#",
      "content": "This example demonstrates how to pay for transaction fees using tokens with BabelSwapPlugin.\nimport { TransactionBuilder } from '@fleet-sdk/core';\nimport { BabelSwapPlugin } from '@fleet-sdk/babel-fees-plugin';\n\nconst tx = new TransactionBuilder(1000000) // Replace with current block height\n  .from(inputs) // Provide input boxes for the transaction\n  .extend(\n    BabelSwapPlugin(babelBox, {\n      tokenId: \"03faf2cb329f2e90d6d23b58d91bbb6c046aa143261cc21f52fbe2824bfcbf04\",\n      amount: \"50\" // The plugin converts this token amount into ERG to cover fees\n    })\n  )\n  .payMinFee() // Ensure the transaction includes the required network fee\n  .sendChangeTo(\"9hY16vzHmmfyVBwKeFGHvb2bMFsG94A1u7To1QWtUokACyFVENQ\") // Define the address for leftover funds after fee conversion\n  .build();\n\nconsole.log(tx);\nExplanation:\nThe code initializes a TransactionBuilder with the current block height.\nfrom(inputs) includes input boxes for the transaction.\nextend(BabelSwapPlugin(...)) adds the BabelSwapPlugin to the transaction. The plugin takes a Babel Box, token ID, and the token amount to convert for ERG fees.\npayMinFee() ensures the inclusion of minimum required network fees.\nsendChangeTo(...) defines the address for remaining funds after fee conversion.\nbuild() finalizes the transaction object.\nThis example showcases how to use Babel Fees with the plugin without any direct ERG input from the user for transaction fees."
    },
    {
      "heading": "API Reference#",
      "content": "Plugins\nBabelSwapPlugin(babelBox: Box<Amount>, token: { tokenId: string, amount: string }): TransactionExtension\n\nDescription: Extends the transaction to incorporate Babel Fees by converting the provided token into ERG needed for fees.\nParameters:\nbabelBox: A valid Babel Box containing tokens and ERG for conversion.\ntoken: An object containing:\ntokenId: The ID of the token to be used for fee conversion.\namount: The amount of tokens to use for the fee payment.\n\n\n\n\nUsage:\n    BabelSwapPlugin(babelBox, {\n  tokenId: \"03faf2cb329f2e90d6d23b58d91bbb6c046aa143261cc21f52fbe2824bfcbf04\",\n  amount: \"50\"\n});"
    },
    {
      "heading": "Utility Functions#",
      "content": "getTokenPrice(babelBox: Box<Amount>): bigint\n\nDescription: Calculates and returns the price of a single token unit in nanoERG based on a specific Babel Box.\nExample:\n    const price = getTokenPrice(babelBox);\nconsole.log(`Price per token: ${price}`);\n\n\n\n\nbuildBabelContract(tokenId: string): string\n\nDescription: Generates the ErgoTree (contract script) for a Babel Box using a specified token ID.\nUsage:\n      const contract = buildBabelContract(tokenId);\n\n\n\n\nisValidBabelBox(box: Box<Amount>): boolean\n\nDescription: Determines if a given box is a valid Babel Box.\nUsage:\n    const isValid = isValidBabelBox(myBox);\nif (isValid) {\n    console.log('This is a valid babel box');\n}\n\n\n\n\nextractTokenIdFromBabelContract(ergoTree: string): string\n\nDescription: Extracts the token ID from a Babel Fee contract script (ErgoTree).\nUsage:\n    const tokenId = extractTokenIdFromBabelContract(ergoTree);\n\n\n\n\nisBabelContractForTokenId(ergoTree: string, tokenId: string): boolean\n\nDescription: Validates if an ErgoTree matches the Babel Fee contract for a specific token ID.\nUsage:\n    const isForToken = isBabelContractForTokenId(ergoTree, tokenId);"
    },
    {
      "heading": "Box Discovery and Identification#",
      "content": "A Babel Box is a container that holds a specified token and associated ERG. This combination allows the plugin to determine the conversion rate between tokens and ERG. The plugin references the Babel Box when it performs token-to-ERG conversions.\nThe hexadecimal representation of the Babel Fees contract:\n100604000e20{tokenId}0400040005000500d803d601e30004d602e4c6a70408d603e4c6a7050595e67201d804d604b2a5e4720100d605b2db63087204730000d606db6308a7d60799c1a7c17204d1968302019683050193c27204c2a7938c720501730193e4c672040408720293e4c672040505720393e4c67204060ec5a796830201929c998c7205029591b1720673028cb272067303000273047203720792720773057202\nReplace {tokenId} with the target token ID. Use the resulting ErgoTree to discover Babel Boxes through the Ergo platform API:\nhttps://api.ergoplatform.com/api/v1/boxes/unspent/byErgoTree/{ErgoTree}\nExample of Fetching a Babel Box:\nconst fetchBabelBox = async (ergoTree: string) => {\n  try {\n    const response = await fetch(`https://api.ergoplatform.com/api/v1/boxes/unspent/byErgoTree/${ergoTree}`);\n    const json = await response.json();\n    return json.items[0]; // Returns the first Babel Box found\n  } catch (error) {\n    console.error(\"Error fetching Babel Box:\", error);\n    return null;\n  }\n};\nThis snippet uses the Ergo API to locate and return a Babel Box. Developers supply an ErgoTree string, and the function queries the blockchain to find a box that matches. The returned Babel Box can then serve as the liquidity source for token-to-ERG conversions in transactions."
    },
    {
      "heading": "Step-by-Step#",
      "content": "For a detailed guide on how to mint a token, set up a Babel Box, and utilize the plugin within a web application, refer to this guide."
    },
    {
      "heading": "Key Updates from CHANGELOG.md#",
      "content": "Validation Enhancements:\n\nIntroduced type validation for Babel Box fields (R4, R5) in version 0.1.16. This ensures that boxes meet strict requirements.\n\n\n\nModule Export Fixes:\n\nAdjusted the ESM and CommonJS exports in version 0.1.10 to prevent issues with package imports."
    },
    {
      "heading": "Package Metadata#",
      "content": "Version: 0.1.18\n\nDependencies:\n\n@fleet-sdk/core \n@fleet-sdk/common \n@fleet-sdk/serializer \n\n\n\nEnvironment:\n\nRequires Node.js 18 or newer."
    },
    {
      "heading": "Reference Implementations#",
      "content": "Implementing Ergo Babel Fees with Fleet-SDK - May 17, 2024\nNautilus Wallet implementation\nAppKit implementation\nFleet SDK Babel fees plugin"
    },
    {
      "heading": "Additional Resources#",
      "content": "Fleet SDK Documentation: Fleet SDK Babel Fees Plugin\nErgo Platform API: Ergo API Documentation\nEIP-0031 Specification: Ergo Babel Fees EIP"
    }
  ],
  "qa_pairs": []
}