{
  "title": "Box Format",
  "source_url": "docs/dev/protocol/tx/format.md",
  "summary": "---\ntags:\n  - Box\n---\n\n# Box Format\n\nIn Ergo's protocol, a 'box' is a fundamental entity that encapsulates various types of information. It is not just an unspent transaction output (UTXO) balance, but a versatile container that can hold value, tokens, custom data, and more. This flexibility allows for complex operations, such as running scripts or smart contracts, directly on the blockchain. ## Registers in a Box\n\nA box is composed of **registers**. Each box can have up to 10 registers, denoted as $R_0, R_1, \\dots, R_9$. Out of these, four registers are mandatory and contain specific values:\n\n- **$R_0$**: Contains the monetary value of the box, stored as a VLQ-encoded unsigned long.",
  "keywords": [
    "format",
    "ergo",
    "protocol",
    "entity",
    "type",
    "information",
    "transaction",
    "output",
    "utxo",
    "balance",
    "container",
    "value",
    "tokens",
    "custom",
    "datum",
    "flexibility",
    "operation",
    "script",
    "contract",
    "blockchain",
    "registers",
    "register",
    "\\dots",
    "guard",
    "ergoscript",
    "condition",
    "contain",
    "token",
    "pair",
    "identifier",
    "byte",
    "amount",
    "integer",
    "metadata",
    "creation",
    "height",
    "index",
    "expression",
    "sigma",
    "language",
    "document](types.md",
    "function",
    "serialization",
    "rule",
    "delimiter",
    "tree",
    "state",
    "structure",
    "monetary",
    "bytes",
    "array",
    "number",
    "tuple",
    "amount)$",
    "additional",
    "candidate",
    "version",
    "r_3$.",
    "placeholder",
    "0^{34",
    "8})$",
    "string",
    "zero",
    "part",
    "inputs",
    "link",
    "application",
    "input",
    "proof",
    "proposition",
    "context",
    "extension",
    "evaluation",
    "data",
    "length",
    "signature",
    "distinct",
    "outputs",
    "candidates",
    "section",
    "message",
    "blake2b256",
    "hash"
  ],
  "sections": [
    {
      "heading": "Box Format",
      "content": "In Ergo's protocol, a 'box' is a fundamental entity that encapsulates various types of information. It is not just an unspent transaction output (UTXO) balance, but a versatile container that can hold value, tokens, custom data, and more. This flexibility allows for complex operations, such as running scripts or smart contracts, directly on the blockchain."
    },
    {
      "heading": "Registers in a Box",
      "content": "A box is composed of registers. Each box can have up to 10 registers, denoted as $R_0, R_1, \\dots, R_9$. Out of these, four registers are mandatory and contain specific values:\n$R_0$: Contains the monetary value of the box, stored as a VLQ-encoded unsigned long.\n$R_1$: Contains a serialized guard script (ErgoScript), which dictates the conditions under which the box can be spent.\n$R_2$: Contains tokens, represented as pairs of token identifiers (32 bytes) and their respective amounts (VLQ-encoded integers).\n$R_3$: Contains metadata including the declared creation height, the unique identifier of the transaction that created the box, and the index of the box in the transaction outputs.\nEach register is an expression in the Sigma language, meaning every register contains a value of a specific type. These types are defined in this document. The value in a register should be a concrete constant value, not a function of a known output type."
    },
    {
      "heading": "Additional Registers",
      "content": "The registers $R_4$ to $R_9$ are optional and can be used to store additional data relevant to the transaction or smart contract. These registers follow the same serialization rules as the mandatory ones, but they are serialized without any delimiters, each as a Sigma expression."
    },
    {
      "heading": "Box Serialization Format",
      "content": "Box bytes are critical for various functions like obtaining the box identifier, building authenticated trees for the blockchain state, and constructing transactions. The serialization of a box follows a specific structure:\nMonetary Value: Serialized as a VLQ-encoded unsigned long value.\nScript Bytes: The serialized script (from $R_1$) is wrapped in a constant array of constant bytes.\nCreation Height: Serialized as a VLQ-encoded unsigned integer.\nNumber of Tokens: Represented as a one-byte unsigned integer. Each token in the box is a tuple $(token_identifier, amount)$, where the identifier is 32 bytes and the amount is a VLQ-encoded integer.\nAdditional Registers: Serialized without any delimiters. The number of non-empty registers is represented as a 1-byte unsigned integer.\nTransaction Identifier: A 32-byte identifier of the transaction that created the box.\nIndex of Transaction Output: Serialized as a VLQ-encoded index of the box in the transaction outputs."
    },
    {
      "heading": "Box Candidate",
      "content": "A Box Candidate is a preliminary version of a box used during transaction creation. It holds the same values in all registers as a fully formed box, except for $R_3$. In a Box Candidate, $R_3$ is initialized with a placeholder value $(creation_height, 0^{34*8})$ where a 34-byte string of zeros replaces the actual transaction ID and output index. This indicates that the box candidate is not yet associated with a specific transaction or output index.\nOnce the transaction is confirmed on the blockchain, the placeholder in $R_3$ is replaced with the actual transaction ID and output index, finalizing the box."
    },
    {
      "heading": "Transaction Format",
      "content": "An Ergo transaction consists of three parts:\nInputs: Links to boxes that will be removed from the state during transaction application. Each input consists of:\n\nA box ID.\nA proof for the final Sigma proposition of this box-protecting script.\nA context extension used during script evaluation.\n\n\n\nData Inputs: Links to boxes that will not be removed from the state but will be available in the context of regular input scripts. This allows transactions to reference additional data without consuming the box.\n\n\nOutputs: New boxes that will be included in the state during transaction application."
    },
    {
      "heading": "Transaction Serialization",
      "content": "Inputs Number: VLQ-encoded number of inputs.\nInputs: Each input is serialized as a 32-byte ID of the box to be spent, the VLQ-encoded length of the signature, the signature itself, and the context extension (as key-value pairs).\nNumber of Data Inputs: VLQ-encoded number of data inputs.\nData Inputs: 32-byte length IDs of data boxes.\nDistinct Tokens Number: Number of distinct tokens in the transaction, represented as a 1-byte unsigned integer.\nToken IDs: 32-byte length IDs of tokens in the transaction.\nOutputs Number: VLQ-encoded number of transaction outputs.\nBox Candidates: Each Box Candidate is serialized similarly to box bytes, but without the transaction identifier and output index. Tokens are represented as index -> amount pairs, where the index is a 1-byte index of the token in the token IDs section."
    },
    {
      "heading": "Signing a Transaction",
      "content": "Input signatures are created by signing the bytesToSign(tx) message, which is calculated as the transaction bytes with all signatures set to zero (VLQ-encoded length of zero). The transaction ID is calculated as a Blake2b256 hash of this message."
    }
  ],
  "qa_pairs": []
}