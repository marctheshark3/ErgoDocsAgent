{
  "title": "Input Blocks and Ordering Blocks \u2013 Technical Details**",
  "source_url": "docs/uses/sidechains/input-blocks.md",
  "summary": "#  Input Blocks and Ordering Blocks \u2013 Technical Details**\n\n## Background on the Current System\n\n  \n- **Current Process:**  \n  Transactions from wallets enter a common mempool. Miners include these transactions in blocks that are produced roughly every 2 minutes.\n  \n- **Replace-By-Fee (RBF):**  \n  RBF allows users to increase transaction fees for faster inclusion or even cancel a transaction by refunding the sender\u2019s wallet. This system can sometimes lead to issues, such as with SigmaUSD mint transactions during fee competitions. ### Limitations\n\n  \n- **Variable Confirmation Times:**  \n  Due to variance in block production, some transactions might take as long as 10 minutes to confirm.\n  \n-",
  "keywords": [
    "input",
    "blocks",
    "ordering",
    "technical",
    "details",
    "background",
    "current",
    "system",
    "process",
    "transaction",
    "wallet",
    "mempool",
    "miner",
    "block",
    "minute",
    "replace",
    "user",
    "inclusion",
    "sender",
    "issue",
    "sigmausd",
    "mint",
    "competition",
    "limitation",
    "variable",
    "confirmation",
    "times",
    "variance",
    "production",
    "friction",
    "step",
    "password",
    "prompt",
    "idea",
    "prism",
    "parallel",
    "proof",
    "work",
    "tailstorm",
    "ergo",
    "kind",
    "consensus",
    "protocol",
    "update",
    "concept",
    "header",
    "field",
    "section",
    "search",
    "nonce",
    "autolykos",
    "function",
    "byte",
    "target",
    "difficulty",
    "adjustment",
    "secp256k1",
    "curve",
    "order",
    "time",
    "role",
    "superblocks",
    "superblock",
    "build",
    "nipopows",
    "level-1",
    "level",
    "test",
    "transition",
    "requirement",
    "propagation",
    "threshold",
    "example",
    "condition",
    "h(ib",
    "generation",
    "period",
    "check",
    "blockchain",
    "structure",
    "dissemination",
    "network",
    "security",
    "handling",
    "data",
    "structures",
    "class",
    "first",
    "transactions",
    "validation",
    "result",
    "dependent",
    "timestamp",
    "merkle",
    "trees",
    "digest",
    "fields",
    "purpose",
    "tree",
    "root",
    "implementation",
    "extension",
    "consistency",
    "verification",
    "mechanisms",
    "announcement",
    "identifier",
    "parent",
    "peers",
    "introspection",
    "message",
    "bitcoin",
    "compact",
    "datum",
    "efficient",
    "protocols",
    "technique",
    "incentives",
    "upgrade",
    "incentive",
    "collection",
    "reward",
    "yield",
    "storage",
    "rent",
    "emission",
    "fork",
    "rule",
    "compatibility",
    "node",
    "supermajority",
    "90+%",
    "hashrate",
    "considerations",
    "checks",
    "flexible",
    "models",
    "notion",
    "feedback",
    "roadmap",
    "deployment",
    "software",
    "upgrades",
    "mining",
    "script",
    "revisions",
    "adjust",
    "procedure",
    "interface",
    "enhancements",
    "signing",
    "sidechain",
    "integration",
    "commitment",
    "scalability",
    "offloading",
    "processing",
    "chain",
    "reference",
    "ergoforum",
    "plan",
    "ergo](https://www.ergoforum.org",
    "ergo/226/5",
    "weak",
    "ergoplatform",
    "pull/2055",
    "prototype",
    "pull/2107/",
    "ittay",
    "13th",
    "symposium",
    "networked",
    "systems",
    "design",
    "nsdi",
    "https://www.usenix.org/system/files/conference/nsdi16/nsdi16-paper-eyal.pdf](https://www.usenix.org/system/files/conference/nsdi16/nsdi16-paper-eyal.pdf",
    "kiffer",
    "lucianna",
    "nakamoto",
    "bounded",
    "capacity",
    "proceeding",
    "sigsac",
    "conference",
    "computer",
    "communications",
    "https://iacr.steepath.eu/2023/381-nakamotoconsensusunderboundedprocessingcapacity.pdf](https://iacr.steepath.eu/2023/381-nakamotoconsensusunderboundedprocessingcapacity.pdf",
    "bagaria",
    "vivek",
    "limit",
    "https://dl.acm.org/doi/pdf/10.1145/3319535.3363213](https://dl.acm.org/doi/pdf/10.1145/3319535.3363213",
    "garay",
    "juan",
    "aggelos",
    "kiayias",
    "shen",
    "annual",
    "international",
    "theory",
    "applications",
    "cryptographic",
    "techniques",
    "keller",
    "patrik",
    "cash",
    "arxiv",
    "preprint",
    "arxiv:2306.12206",
    "nikos",
    "leonardos",
    "backbone",
    "analysis",
    "journal",
    "https://dl.acm.org/doi/pdf/10.1145/3653445](https://dl.acm.org/doi/pdf/10.1145/3653445"
  ],
  "sections": [
    {
      "heading": "Background on the Current System",
      "content": "Current Process:\n  Transactions from wallets enter a common mempool. Miners include these transactions in blocks that are produced roughly every 2 minutes.\n\n\nReplace-By-Fee (RBF):\n  RBF allows users to increase transaction fees for faster inclusion or even cancel a transaction by refunding the sender\u2019s wallet. This system can sometimes lead to issues, such as with SigmaUSD mint transactions during fee competitions."
    },
    {
      "heading": "Limitations",
      "content": "Variable Confirmation Times:\n  Due to variance in block production, some transactions might take as long as 10 minutes to confirm.\n\n\nUser Friction:\n  The current system involves repeated manual steps (like multiple password prompts) that slow down the overall process."
    },
    {
      "heading": "2. Introducing Input Blocks and Ordering Blocks",
      "content": "Following ideas in PRISM [3], Parallel Proof-of-Work [4], and Tailstorm [5], Ergo introduces two kinds of blocks via a non-breaking consensus protocol update."
    },
    {
      "heading": "Revisiting the Current Block Concept",
      "content": "A valid block in the current Ergo protocol is formed by semantically valid header fields and corresponding block sections (including transactions). Miners search for a nonce such that:\nH(b) < T\nwhere:\nH(b): is the Autolykos Proof-of-Work function applied to the block header bytes (including nonce),\nT: is the Proof-of-Work target, and\nDifficulty (D): is defined as D = 2^256 / T (with adjustments for the secp256k1 curve order).\nDifficulty is readjusted to maintain an average block production time of 2 minutes."
    },
    {
      "heading": "The Role of Superblocks",
      "content": "Superblocks:\n  Used for building NiPoPoWs, a superblock (e.g., a level-1 superblock S) must satisfy:\n  H(S) < T/2\n  In general, an n-level superblock must satisfy:\n  H(S) < T/2^n\n  Every superblock is also a valid block under the standard PoW test."
    },
    {
      "heading": "Transition to Input Blocks and Ordering Blocks",
      "content": "Ordering Blocks:\n  These are the full blocks (with the original PoW requirements) and will continue to be produced every 2 minutes.\n\n\nInput Blocks (Sub-blocks):\n  To enable faster transaction propagation, input blocks are introduced with a lower difficulty threshold. For example, by setting:\n  t = T/64\n  and defining the input block condition as:\n  H(ib) < t\n  a miner can generate, on average, 63 input blocks alongside 1 ordering block per ordering block generation period. Unlike superblocks, input blocks are not required to pass the ordering block PoW check, though every ordering block must pass the input block check.\n\n\nBlockchain Structure:\n  The resulting blockchain may look like:\n  (ordering block) - input block - input block - input block - (ordering block) - input block - input block - (ordering block) \u2026\n  This structure facilitates rapid transaction dissemination while preserving overall network security."
    },
    {
      "heading": "Transaction Classes",
      "content": "First-Class Transactions:\n  These transactions yield consistent validation results across all input blocks (approximately 99% of typical transactions) and are included solely in input blocks.\n\n\nSecond-Class Transactions:\n  Dependent on variables like block timestamps or miner public keys, these transactions might validate differently between input and ordering blocks, so they are included in both."
    },
    {
      "heading": "Merkle Trees and Digest Fields",
      "content": "Purpose:\n  Miners maintain Merkle tree roots for:\n\n\nAll first-class transactions since the last ordering block.\n\n\nTransactions included in the input blocks.\n\n\nImplementation:\n  These digest fields are embedded in the block header extensions to ensure consistency and efficient verification, even as input blocks are rapidly generated."
    },
    {
      "heading": "Block Propagation Mechanisms",
      "content": "Announcement:\n  When an input block is generated, its header and the identifier of its parent input block are announced.\n\n\nData Verification:\n  Peers request an introspection message containing proofs and Merkle tree digests (similar to weak IDs in Bitcoin\u2019s Compact Blocks) to verify transaction data efficiently.\n\n\nEfficient Protocols:\n  Cut-through propagation techniques are employed to ensure that transaction identifiers and confirmations are rapidly disseminated across the network."
    },
    {
      "heading": "Incentives",
      "content": "Fee Collection:\n  Miners earn fees from first-class transactions included in input blocks.\n\n\nAdditional Rewards:\n  Ordering blocks yield rewards from second-class transactions, as well as storage rent and emission rewards."
    },
    {
      "heading": "Soft Fork Upgrade",
      "content": "The new rules will be implemented via a soft fork. This ensures backward compatibility\u2014older nodes will still receive standard block transaction messages until a supermajority (90+% of the hashrate) upgrades."
    },
    {
      "heading": "Security Considerations",
      "content": "Validation Checks:\n  Every ordering block must pass the input block validation check, which prevents invalid transactions from being confirmed.\n\n\nFlexible Confirmation Models:\n  The protocol supports a \u201cweaker\u201d notion of confirmation for rapid user feedback while retaining full network security through ordering blocks."
    },
    {
      "heading": "Implementation Roadmap",
      "content": "Deployment:\n   Introduce input blocks alongside existing ordering blocks.\nMiner Software Upgrades:\n   Update mining nodes to support input block generation and propagation.\nTransaction and Fee Script Revisions:\n   Adjust fee scripts (e.g., setting fee scripts to \u201ctrue\u201d as needed) and update transaction validation procedures.\nUser Interface Enhancements:\n   Improve wallet interfaces to streamline transaction signing.\nSidechain Integration:\n   Enable input blocks to carry sidechain commitments, further enhancing scalability and offloading processing from the main chain."
    },
    {
      "heading": "References",
      "content": "Ergoforum: A Scalability Plan for Ergo \nWeak Blocks WIP #1 #2055 \nA Sidechain Prototype #2107 \nEyal, Ittay, et al. \"Bitcoin-NG: A scalable blockchain protocol.\" 13th USENIX Symposium on Networked Systems Design and Implementation (NSDI 16), 2016. https://www.usenix.org/system/files/conference/nsdi16/nsdi16-paper-eyal.pdf \nKiffer, Lucianna, et al. \"Nakamoto Consensus under Bounded Processing Capacity.\" Proceedings of the 2024 ACM SIGSAC Conference on Computer and Communications Security, 2024. https://iacr.steepath.eu/2023/381-NakamotoConsensusunderBoundedProcessingCapacity.pdf \nBagaria, Vivek, et al. \"Prism: Deconstructing the blockchain to approach physical limits.\" Proceedings of the 2019 ACM SIGSAC Conference on Computer and Communications Security, 2019. https://dl.acm.org/doi/pdf/10.1145/3319535.3363213 \nGaray, Juan, Aggelos Kiayias, and Yu Shen. \"Proof-of-work-based consensus in expected-constant time.\" Annual International Conference on the Theory and Applications of Cryptographic Techniques, 2024. https://eprint.iacr.org/2023/1663.pdf \nKeller, Patrik, et al. \"Tailstorm: A secure and fair blockchain for cash transactions.\" arXiv preprint arXiv:2306.12206 (2023). https://arxiv.org/pdf/2306.12206 \nGaray, Juan, Aggelos Kiayias, and Nikos Leonardos. \"The Bitcoin Backbone Protocol: Analysis and Applications.\" Journal of the ACM 71.4 (2024): 1-49. https://dl.acm.org/doi/pdf/10.1145/3653445"
    }
  ],
  "qa_pairs": []
}