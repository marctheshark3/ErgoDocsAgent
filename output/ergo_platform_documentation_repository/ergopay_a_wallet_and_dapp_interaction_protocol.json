{
  "title": "ErgoPay: A Wallet and dApp Interaction Protocol",
  "source_url": "docs/dev/wallet/payments/standards/eip20.md",
  "summary": "---\ntags:\n  - EIP\n---\n\n# ErgoPay: A Wallet and dApp Interaction Protocol\n\n> \ud83d\udd17 Refer to [EIP-0020](https://raw.githubusercontent.com/ergoplatform/eips/master/eip-0020.md) for more details. * Author: @aslesarenko, @MrStahlfelge\n* Status: Proposed\n* Created: 18-August-2021\n\n\n\n## Table of Contents\n- [ErgoPay: A Wallet and dApp Interaction Protocol](#ergopay-a-wallet-and-dapp-interaction-protocol)\n  - [Table of Contents](#table-of-contents)\n  - [Overview](#overview)\n  - [Background and Motivation](#background-and-motivation)\n  - [ErgoPay Interaction Protocol](#ergopay-interaction-protocol)\n  - [Data Formats](#data-formats)\n    - [Option 1: dApp Provides URL Request for ErgoPaySigningRequest Information](#option-1-dapp-provides-url-request-for-ergopaysigningrequest-information)\n      -",
  "keywords": [
    "ergopay",
    "wallet",
    "dapp",
    "interaction",
    "protocol",
    "refer",
    "eip-0020](https://raw.githubusercontent.com",
    "ergoplatform",
    "master",
    "eip-0020.md",
    "detail",
    "author",
    "@aslesarenko",
    "@mrstahlfelge",
    "status",
    "august-2021",
    "table",
    "contents",
    "protocol](#ergopay",
    "contents](#table",
    "content",
    "overview](#overview",
    "background",
    "motivation](#background",
    "motivation",
    "data",
    "formats](#data",
    "format",
    "option",
    "request",
    "information](#option-1",
    "provide",
    "information",
    "response",
    "scheme",
    "reducedtransaction](#option-2",
    "reducedtransaction",
    "implementation](#wallet",
    "implementation",
    "implementation](#dapp",
    "benefit",
    "dapps](#benefit",
    "dapps",
    "wallets](#benefit",
    "overview",
    "standard",
    "creation",
    "signing",
    "ergo",
    "transaction",
    "cryptocurrency",
    "android",
    "wallet](https://github.com",
    "code",
    "payment",
    "requests](https://explorer.ergoplatform.com",
    "request?address=9er9hxmvcl8s4bnypcyjhppeekafed9clq5gnrhn6s2pyomp55n&amount=0&description=",
    "link",
    "scheme](https://github.com",
    "bitcoin",
    "bips",
    "blob",
    "bip-0021.mediawiki",
    "device",
    "blockchain",
    "asset",
    "address",
    "p2pk",
    "model",
    "contract",
    "condition",
    "spending",
    "context",
    "variable",
    "number",
    "output",
    "registers](registers.md",
    "application",
    "hand",
    "business",
    "logic",
    "word",
    "control",
    "problem",
    "knowledge",
    "confirmation",
    "screen",
    "user",
    "inboxe",
    "outboxes",
    "eip-0012](https://github.com",
    "browser",
    "javascript",
    "design",
    "desktop",
    "reference",
    "question",
    "step",
    "process",
    "proceed",
    "placeholder",
    "datum",
    "obtain",
    "section",
    "case",
    "sign",
    "button",
    "behave",
    "cold",
    "eip-0019",
    "result",
    "signedtransaction",
    "ergopaytransactionsent",
    "post",
    "message",
    "txid",
    "unsignedtransaction",
    "fact",
    "requirement",
    "instance",
    "time",
    "reason",
    "situation",
    "structure",
    "serialization",
    "below",
    "https",
    "prefix",
    "http",
    "communication",
    "network",
    "example",
    "https://sigmausd.io/signingrequest/2001-16b8-66c4-b800-6e52-8ce4",
    "ergopay://192.168.0.1",
    "html",
    "http://192.168.0.1",
    "ergopay://auctionhouse.org/bid/#p2pk_address",
    "ergopay://auctionhouse.org/bid/3wx7z8fywal4ofundcv1natjx5cpjtubmrjpckehnnbagjlgfrcd",
    "string",
    "messageseverity",
    "warning",
    "error",
    "replytourl",
    "optionally",
    "json",
    "node",
    "reply",
    "mempool",
    "containing",
    "ergopay:<reducedtransaction",
    "base",
    "description",
    "interchange",
    "developer",
    "mind",
    "length",
    "restriction",
    "char",
    "payload",
    "higher](https://github.com",
    "showcase",
    "example](https://github.com",
    "mrstahlfelge",
    "server",
    "good",
    "service",
    "website",
    "checkout",
    "conversion",
    "rate",
    "loyalty",
    "purchase",
    "frequency",
    "secret",
    "intent",
    "security",
    "product",
    "page",
    "cart",
    "setting",
    "method",
    "size",
    "quantity",
    "flexibility",
    "wallets",
    "team",
    "feature"
  ],
  "sections": [
    {
      "heading": "ErgoPay: A Wallet and dApp Interaction Protocol",
      "content": "\ud83d\udd17 Refer to EIP-0020 for more details.\nAuthor: @aslesarenko, @MrStahlfelge\nStatus: Proposed\nCreated: 18-August-2021"
    },
    {
      "heading": "Table of Contents",
      "content": "ErgoPay: A Wallet and dApp Interaction Protocol\nTable of Contents\nOverview\nBackground and Motivation\nErgoPay Interaction Protocol\nData Formats\nOption 1: dApp Provides URL Request for ErgoPaySigningRequest Information\nResponse: ErgoPaySigningRequest\nOption 2: dApp Provides URI Scheme Containing ReducedTransaction\n\n\nWallet App Implementation\ndApp Implementation\nBenefits for dApps\nBenefits for Wallets"
    },
    {
      "heading": "Overview",
      "content": "ErgoPay is a standard for cross-platform interaction between an online dApp and a wallet app. It facilitates the creation, signing, and sending of Ergo transactions."
    },
    {
      "heading": "Background and Motivation",
      "content": "Cryptocurrency wallets, such as the Ergo Android Wallet, typically support scanning QR codes of Payment Requests or intercepting a link with a special URI scheme. After parsing a payment request, the wallet can build a new transaction, sign it using a secret key stored locally on the device, and then send it to the blockchain.\nHowever, this is only possible for simple transactions, such as transferring ERGs and assets between Pay-To-Public-Key addresses or transactions that only spend boxes from P2PK addresses.\nIn Ergo's eUTXO model, a box can be protected by an arbitrarily complex contract (aka spending condition), and any spending transaction should satisfy that condition by adding required context variables, creating an expected number of outputs with specific registers depending on the contract. A universal wallet application cannot know all the specific details of all possible contracts.\nOn the other hand, every Ergo dApp is usually built on top of specific contracts. The business logic of the dApp includes spending of the boxes protected by those application-specific contracts. In other words, any dApp is in full control of creating transactions and thus can spend its own contracts without the above-mentioned problems. However, the dApp cannot sign those transactions, because signing requires knowledge of private keys which are not stored on the dApp, but instead stored on the wallet app.\nTherefore, an interaction between a dApp and a wallet is required such that:\nThe dApp builds a transaction and makes it available for the wallet application.\nThe wallet app shows a confirmation screen to the user, displaying the inboxes and outboxes it is going to sign.\nWhen the user confirms, the wallet app signs the transaction and submits it to the blockchain or returns it back to the dApp.\nThe dApp monitors the transaction on the blockchain and upon confirmations, proceeds with its business logic.\nOne possible implementation of such an interaction scheme is described in E..."
    },
    {
      "heading": "ErgoPay Interaction Protocol",
      "content": "An ErgoPay interaction between a Wallet and a dApp is driven by the dApp's user and proceeds as follows:\nThe user enters the necessary information in the dApp's UI and proceeds to a payment screen. Optionally, the dApp can request the user's P2PK address with an extra step using a signing request with a placeholder URL (see below).\n\n\nThe payment screen shows transaction details and a QR code as well as a clickable link.\n\n\nThe user clicks the link to hand the information over to a wallet application on the same device, or scans the QR code using a wallet application.\n\n\nThe Wallet application parses the QR code data and obtains either ErgoPaySigningRequest or ReducedTransaction data (see Data Formats section). In the former case, the QR code data contains a URL to download ErgoPaySigningRequest from the dApp.\n\n\nWhen ErgoPaySigningRequest or ReducedTransaction is obtained, it is shown as a payment screen on the wallet app containing the same transaction details as the dApp screen.\n\n\nThe user compares the dApp's screen, the Wallet's screen, and the transaction details and confirms the payment by using a \"Sign\" button. If the Wallet also supports EIP-0019 and private keys are not available, then the sign button behaves like a \"Cold Sign\" button according to EIP-0019.\n\n\nThe wallet application signs the transaction either using local private keys or using a Cold Wallet and EIP-0019 protocol. The result of signing is SignedTransaction data.\n\n\nThe Wallet obtains the transaction id and sends it to the dApp using ErgoPayTransactionSent API post message to replyToUrl if the URL is provided. If successful, the wallet then submits SignedTransaction to the blockchain. If the URL is not provided, then the wallet submits the transaction to the blockchain without notifying the dApp. The dApp can monitor the blockchain by txId which it can learn from UnsignedTransaction. This is based on the fact that UnsignedTransaction.id == SignedTransaction.id holds for all transactions.\n\n\nThe dAp..."
    },
    {
      "heading": "Data Formats",
      "content": "The data formats of this EIP are based on a new binary data structure and serialization format called ReducedTransaction, which is described in EIP-0019.\nBelow we describe the data formats specified by this EIP and refer to the formats defined in EIP-0019.\nWallet apps should be able to initiate ErgoPay both by using URI schemes (clickable links) or QR codes."
    },
    {
      "heading": "Option 1: dApp Provides URL Request for ErgoPaySigningRequest Information",
      "content": "ergopay://<URL>\nThe URL is provided without the https prefix. HTTP communication is not allowed except for IP addresses (for testing within a local network).\nThe provided URL can contain a #P2PK_ADDRESS# placeholder. The wallet application will replace this placeholder with an actual P2PK address.\nExamples:\nergopay://sigmausd.io/signingRequest/2001-16b8-66c4-b800-6e52-8ce4 will make the wallet app request https://sigmausd.io/signingRequest/2001-16b8-66c4-b800-6e52-8ce4.\nergopay://192.168.0.1/html will make the wallet app request http://192.168.0.1/html.\nergopay://auctionhouse.org/bid/#P2PK_ADDRESS# will make the wallet app request ergopay://auctionhouse.org/bid/3Wx7Z8FywaL4ofunDCV1NaTJX5CpjTubMrjpCkEhnNBAgJLGfRcD."
    },
    {
      "heading": "Response: ErgoPaySigningRequest",
      "content": "The wallet application should request the URL and obtain the following data (in JSON format):\nErgoPaySigningRequest:\n  - transaction: ReducedTransaction (optional*)\n  - address: String (optional)\n  - message: String (optional*)\n  - messageSeverity: String (optional) \"INFORMATION\", \"WARNING\", \"ERROR\"\n  - replyToUrl: String (optional)\nEither a transaction or a message must be provided, otherwise the request is invalid.\nThe wallet application should show the message and display the messageSeverity in a suitable way, if provided.\nIf transaction details are obtained, a payment screen opens for the user to confirm signing the transaction. Transaction details CAN BE OPTIONALLY shown on the payment screen of the wallet application.\nIf address is provided by the dApp, the wallet can preselect the key the user needs to sign the transaction.\nAfter signing is performed and the SignedTransaction data is obtained, the wallet can POST the following data to the dApp using replyToUrl from the signing request (in JSON format) if it is provided.\nErgoPayTransactionId:\n  - txId: String\ndApps should not rely on this request to be made. It could happen that the transaction was submitted to a node, but the reply couldn't be executed. dApps know the transaction id and should monitor the mempool and blockchain on their own.\nIn case no transaction was provided, the wallet app displays the message that should inform the user about further steps needed."
    },
    {
      "heading": "Option 2: dApp Provides URI Scheme Containing ReducedTransaction",
      "content": "When the dApp does not need to use an extra request, the ReducedTransaction could also be encoded in the QR code or link:\nergopay:<ReducedTransaction, base 64 url safe encoded>\nIt is not possible to provide description, address, message, and replyToUrl in this simpler interchange format.\ndApp developers should keep in mind that there are length restrictions for URI schemes and QR codes. Both should be able to handle up to 2900 chars, but QR codes with a lot of content need to be shown bigger to be read without problems.\nWe recommend using a URL request if the payload exceeds 400 chars."
    },
    {
      "heading": "Wallet App Implementation",
      "content": "Ergo Wallet App 1.6 or higher"
    },
    {
      "heading": "dApp Implementation",
      "content": "ErgoPay showcase example"
    },
    {
      "heading": "Benefits for dApps",
      "content": "ErgoPay provides a fast, easy, and secure way for users to buy goods and services in a dApp or on a website. When supported, ErgoPay can substantially increase checkout conversion rates, user loyalty and purchase frequency, and reduce checkout time.\ndApp or website don\u2019t need to handle user's secrets (mnemonic/private keys). Instead, once the user has signed the transaction to confirm purchase intent, your app or website receives a transaction id to monitor payment status on the blockchain.\ndApp's users don't need to worry about the security of their private keys as the wallet app guarantees they never leave the device.\nErgoPay EIP is compatible with Cold Wallet EIP, thus users can use Cold Wallet devices to sign transactions within the ErgoPay signing process.\nAdding ErgoPay to product detail pages, the cart, checkout page, in payment settings, or anywhere else a user can choose ErgoPay as the payment method or initiate a purchase.\nThe payment screen can be presented immediately after the user taps the Ergo Pay button, without any interim screens or pop-ups except to prompt for necessary product details, such as size or quantity.\nErgoPay is simple and universal. It supports all smart contracts and offers the flexibility to implement simple to complex dApps."
    },
    {
      "heading": "Benefits for Wallets",
      "content": "Any wallet application team should consider supporting ErgoPay in their wallet along with basic wallet features. Users can participate in Ergo dApps and the wallet team can receive service fees from those transactions."
    }
  ],
  "qa_pairs": []
}