{
  "title": "Bitcoin Rosen Bridge Watcher Setup",
  "source_url": "docs/eco/rosen/bitcoin-watcher.md",
  "summary": "# Bitcoin Rosen Bridge Watcher Setup\n\nTo participate as a watcher in the Rosen Bridge, you need to deploy a watcher app that observes one of the supported networks. Each supported network has its own set of watchers responsible for reporting users' actions on that specific network. ## Docker Setup\n\n/// admonition | This section is adapted from the [deploy-docker.md](https://github.com/rosen-bridge/operation/blob/dev/docs/watcher/deploy-docker.md) section on the Rosen Bridge documentation. type: info\n///\n\n\n\n\nClone the [Operation repository](https://github.com/rosen-bridge/operation.git) and navigate to the `operation/watcher` directory:\n\n```shell\ngit clone https://github.com/rosen-bridge/operation.git\ncd operation/watcher/\n```\n\nCreate your environment file `.env` based on the `env.template` file in the `watcher` directory:\n\n```shell\ncp env.template .env\n```\n\nTo view hidden `.env` files later, use `ls -a`.\n\n### Environment Variable Configurations\n\nConfigure the required environment variables in the `.env` file (ensure no spaces after the '=' sign):\n\n```shell\n# Required Environments\n\nPOSTGRES_PASSWORD=your_random_password\nPOSTGRES_USER=your_random_username\nPOSTGRES_DB=your_random_db_name\nPOSTGRES_PORT=5432\n```\n\nSet the required permissions and create the `local.yaml` file in the `config` directory:\n\n```shell\nsudo chown -R 3000:3000 logs\ntouch config/local.yaml\n```\n\nFor MacOS users, set `707` permission for the `logs` directory:\n\n```shell\nsudo chmod -R 707 logs\n```\n\n//// details | Working with Docker\n\n/// details | Checking logs\n{type: info, open: false}\nTo check logs, use:\n\n```bash\ndocker compose logs\n```\n\n///\n\n/// details | Updating your watcher\n{type: info, open: false}\nTo update your watcher, use:\n\n```bash\ndocker compose pull\ndocker compose down\ndocker compose up -d\n```\n\n///\n\n/// details | Restarting your watcher\n{type: info, open: false}\nTo restart your watcher instance, run:\n\n```bash\ndocker compose up -d\n```\n\n///\n\n/// details |",
  "keywords": [
    "bitcoin",
    "rosen",
    "bridge",
    "watcher",
    "setup",
    "network",
    "user",
    "action",
    "docker",
    "admonition",
    "section",
    "deploy",
    "operation",
    "blob",
    "documentation",
    "type",
    "info",
    "directory",
    "shell",
    "clone",
    "https://github.com/rosen-bridge/operation.git",
    "environment",
    "file",
    ".env",
    "variable",
    "configurations",
    "space",
    "sign",
    "required",
    "environments",
    "your_random_password",
    "postgres_user",
    "your_random_username",
    "postgres_db",
    "your_random_db_name",
    "postgres_port=5432",
    "permission",
    "local.yaml",
    "config",
    "touch",
    "macos",
    "chmod",
    "////",
    "detail",
    "checking",
    "bash",
    "pull",
    "down",
    "instance",
    "configuration",
    "danger",
    "compose",
    "command",
    "folder",
    "dumping",
    "database",
    "volume",
    "watcher_postgre",
    "data",
    "---edit",
    "block",
    "height",
    "yaml",
    "step",
    "clearing",
    "volumes",
    "clean",
    "slate",
    "scratch",
    "containerid1",
    "containerid2",
    "containerid3",
    "note",
    "raspberry",
    "users",
    "image",
    "docker-compose.yml",
    "architecture",
    "arm64v8",
    "diff",
    "service",
    "rapidfort",
    "postgresql:16.0.0",
    "postgres:16.0",
    "postgre",
    "data:/bitnami",
    "postgresql",
    "data:/var",
    "images",
    "instruction",
    "local",
    "change",
    "container",
    "target",
    "ergo",
    "apikeyhash",
    "your_api_key_hash",
    "unlock",
    "hash",
    "blake2b",
    "algorithm",
    "util",
    "tree",
    "package",
    "@rosen",
    "your_api_key",
    "--rm",
    "node:18.16",
    "information",
    "source",
    "connection",
    "your_rpc_url",
    "your_rpc_username",
    "password",
    "your_rpc_password",
    "node",
    "performance",
    "decentralization",
    "disk",
    "install",
    "core",
    "instructions](https://bitcoin.org",
    "download",
    "configure",
    "locate",
    "datum",
    "linux",
    "~/.bitcoin/",
    "application",
    "support",
    "bitcoin/",
    "windows",
    "text",
    "editor",
    "username",
    "generator](https://jlopp.github.io",
    "auth",
    "generator",
    "line",
    "edit",
    "server",
    "paste",
    "server=1",
    "rpcbind=0.0.0.0",
    "txindex=1",
    "access",
    "rpcallowip",
    "range",
    "rpcallowip=172.16.0.0/12",
    "bitcoind",
    "stop",
    "-daemon",
    "getblockchaininfo",
    "pruned",
    "setting",
    "sync",
    "dbcache",
    "example",
    "cache",
    "bitcoin.conf",
    "conf",
    "dbcache=4096",
    "value",
    "memory",
    "current",
    "blockchain",
    "size",
    "june",
    "mind",
    "storage",
    "snapshots",
    "snapshot",
    "process",
    "requirement",
    "transaction",
    "indexing",
    "monitoring",
    "progress",
    "verificationprogress",
    "field",
    "output",
    "machine",
    "resource",
    "rpc.url",
    "address",
    "port",
    "ip>:8332",
    "enabling",
    "broadcasting",
    "debugging",
    "zmqpubrawtx",
    "tcp://0.0.0.0:28332",
    "zeromq",
    "broadcast",
    "feature",
    "esplora",
    "https://mempool.space",
    "latest_bitcoin_height",
    "customize",
    "observation",
    "confirmation",
    "validity",
    "threshold",
    "validthreshold",
    "wallet",
    "mnemonic",
    "your_wallet_mnemonic",
    "https://example.node.com",
    "explorer",
    "initialheight",
    "your_bitcoin_rpc_url",
    "permit",
    "localhost:3030](http://localhost:3030",
    "dashboard",
    "asset",
    "health",
    "status",
    "button",
    "lock",
    "registration",
    "reporting",
    "amount",
    "responsibility",
    "event",
    "report",
    "payment",
    "collateral",
    "time",
    "form",
    "security",
    "measure",
    "sybil",
    "attack",
    "permits",
    "token",
    "number",
    "reward",
    "penalty",
    "troubleshooting",
    "faqs",
    "documentation](watcher.md"
  ],
  "sections": [
    {
      "heading": "Bitcoin Rosen Bridge Watcher Setup",
      "content": "To participate as a watcher in the Rosen Bridge, you need to deploy a watcher app that observes one of the supported networks. Each supported network has its own set of watchers responsible for reporting users' actions on that specific network."
    },
    {
      "heading": "Docker Setup",
      "content": "/// admonition | This section is adapted from the deploy-docker.md section on the Rosen Bridge documentation.\n    type: info\n///\nClone the Operation repository and navigate to the operation/watcher directory:\nshell\ngit clone https://github.com/rosen-bridge/operation.git\ncd operation/watcher/\nCreate your environment file .env based on the env.template file in the watcher directory:\nshell\ncp env.template .env\nTo view hidden .env files later, use ls -a."
    },
    {
      "heading": "Environment Variable Configurations",
      "content": "Configure the required environment variables in the .env file (ensure no spaces after the '=' sign):\n```shell"
    },
    {
      "heading": "Required Environments",
      "content": "POSTGRES_PASSWORD=your_random_password\nPOSTGRES_USER=your_random_username\nPOSTGRES_DB=your_random_db_name\nPOSTGRES_PORT=5432\n```\nSet the required permissions and create the local.yaml file in the config directory:\nshell\nsudo chown -R 3000:3000 logs\ntouch config/local.yaml\nFor MacOS users, set 707 permission for the logs directory:\nshell\nsudo chmod -R 707 logs\n//// details | Working with Docker\n/// details | Checking logs\n{type: info, open: false}\nTo check logs, use:\nbash\ndocker compose logs\n///\n/// details | Updating your watcher\n{type: info, open: false}\nTo update your watcher, use:\nbash\ndocker compose pull\ndocker compose down\ndocker compose up -d\n///\n/// details | Restarting your watcher\n{type: info, open: false}\nTo restart your watcher instance, run:\nbash\ndocker compose up -d\n///\n/// details | no configuration files provided: not found\n{type: danger, open: false}\nEnsure you're in the correct directory. You should execute docker compose commands from within the operation/watcher folder.\n///\n/// details | Dumping databases\n{type: info, open: false}\nTo dump databases, use:\n```bash\ndocker compose down\ndocker volume remove watcher_postgres-data"
    },
    {
      "heading": "---edit block height in YAML after this step",
      "content": "docker compose up -d\n```\n///\n/// details | Clearing Volumes\n{type: info, open: false}\nTo clear Docker volumes, use:\nbash\ndocker compose down --volumes\nRe-initiate the watcher with:\nbash\ndocker compose up -d\n///\n/// details | Clean Slate\n{type: info, open: false}\nTo remove everything and start from scratch:\nbash\ndocker ps -a\ndocker compose down\ndocker rm CONTAINERID1 CONTAINERID2 CONTAINERID3\nThen delete the folder and start fresh.\n///\n////\n/// details | Note for Raspberry Pi ARM Users\n{type: info, open: false}\nTo run the watcher on an ARM-based Raspberry Pi, use an ARM-based DB image. Update the docker-compose.yml as follows:\nChange the DB image according to your architecture (e.g., arm64v8):\ndiff\nservices:\n  db:\n-   image: rapidfort/postgresql:16.0.0\n+   image: arm64v8/postgres:16.0\nUpdate the volume of the DB:\ndiff\n    volumes:\n-     - postgres-data:/bitnami/postgresql\n+     - postgres-data:/var/lib/postgresql/data/\n///"
    },
    {
      "heading": "Pull Docker Images and Run Service",
      "content": "Pull the Docker image:\nshell\ndocker compose pull\nSet up your local.yaml using the instructions in the next section (Local Config). After saving the changes, run the container:\nshell\ndocker compose up -d"
    },
    {
      "heading": "Local Config",
      "content": "To start your watcher, configure the local.yaml file."
    },
    {
      "heading": "Specify the Target Network",
      "content": "Set the target network you're watching. Currently supported networks are ergo, cardano, and bitcoin:\nyaml\nnetwork: bitcoin"
    },
    {
      "heading": "API Configuration",
      "content": "yaml\napi:\n  apiKeyHash: \"YOUR_API_KEY_HASH\"\nTo secure the action-based APIs (e.g., lock, unlock), set a unique and robust API key hash using the Blake2b algorithm. You can generate the hash using the rosen command line:\nshell\nnpx @rosen-bridge/cli blake2b-hash YOUR_API_KEY\nAlternatively, use Docker:\nshell\ndocker run -it --rm node:18.16 npx --yes @rosen-bridge/cli blake2b-hash YOUR_API_KEY"
    },
    {
      "heading": "Bitcoin Configuration",
      "content": "Choose your information source for the Bitcoin network and specify its connection information.\nYou can use either rpc\nyaml\nbitcoin:\n  type: rpc\n  rpc:\n    url: \"YOUR_RPC_URL\"\n    username: \"YOUR_RPC_USERNAME\"\n    password: \"YOUR_RPC_PASSWORD\"\n//// details | Setting Up a Bitcoin Node (RPC)\n{type: info, open: false}\nFor optimal watcher performance and decentralization, running your own fully synced Bitcoin node is recommended. However, this consumes significant disk space, so you can use a public node as detailed in the next section.\nInstall Bitcoin Core following the official instructions for your OS.\n\n\nConfigure Bitcoin Core:\n\n\nLocate the bitcoin.conf file in the Bitcoin data directory:\n\nLinux: ~/.bitcoin/\nmacOS: ~/Library/Application Support/Bitcoin/\nWindows: %APPDATA%\\Bitcoin\\\n\n\n\nOpen bitcoin.conf with a text editor or create it if it doesn't exist.\n\n\nGenerate an RPC username and password:\n\n\nVisit this RPC auth generator\n\nEnter a username and click \"Generate\"\n\nCopy the generated line starting with rpcauth=\n\n\nEdit bitcoin.conf to enable the RPC server and allow the watcher to connect:\n\n\nPaste the rpcauth line you copied\n\nAdd the following lines to enable the RPC server:\n     bash\n     server=1\n     rpcbind=0.0.0.0\n     rpcallowip=0.0.0.0/0\n     txindex=1\n     rest=1\n\nTo limit RPC access to only the watcher container, set rpcallowip to the Docker network range:\nbash\n rpcallowip=172.16.0.0/12\n\n\nSave the file\n\n\nIf bitcoind was already running, stop and restart it:\nbash\n   bitcoin-cli stop\n   bitcoind -daemon\nVerify the node is running and wait for it to sync:\n   bash\n   bitcoin-cli getblockchaininfo\n   Look for \"initialblockdownload\": false to confirm the node is synced.\n/// details | Running a Pruned Bitcoin Node\n{type: info, open: false}\nA pruned Bitcoin node is not compatible with the Rosen Bitcoin bridge watcher. The watcher requires the txindex=1 setting, which is not supported by pruned nodes. If you initially synced a pruned node, you'll need to restart the syn..."
    },
    {
      "heading": "Ergo Configuration",
      "content": "/// admonition | Even if you are running a Bitcoin Watcher, you must configure the Ergo section\n    type: warning\n///\nCreate a new wallet and set the wallet mnemonic, you can also load this through an environmental variable so it's only stored in-memory.\nyaml\nergo:\n  mnemonic: \"YOUR_WALLET_MNEMONIC\"\nSelect your primary data source:\nyaml\nergo:\n  type: node\n  node:\n    url: https://example.node.com\n  explorer:\n    url: https://api.ergoplatform.com\nSet the initial height of your watcher:\nyaml\ninitialHeight: LATEST_HEIGHT\nCustomize observation confirmation and validity threshold:\nyaml\nobservation:\n  confirmation: 10\n  validThreshold: 720"
    },
    {
      "heading": "Example Configuration for Bitcoin Watcher",
      "content": "yaml\nnetwork: bitcoin\napi:\n  apiKeyHash: \"YOUR_API_KEY_HASH\"\nergo:\n  type: explorer\n  initialHeight: LATEST_ERGO_HEIGHT\n  mnemonic: \"YOUR_WALLET_MNEMONIC\"\n  node:\n    url: https://example.node.com\nbitcoin:\n  type: rpc\n  rpc:\n    url: \"YOUR_BITCOIN_RPC_URL\"\n    username: \"YOUR_RPC_USERNAME\"\n    password: \"YOUR_RPC_PASSWORD\"\n  initial:\n    height: LATEST_BITCOIN_HEIGHT\nobservation:\n  confirmation: 2\n  validThreshold: 72"
    },
    {
      "heading": "Get Your Watcher Permit",
      "content": "After setting up and running your watcher instance, access the watcher UI by visiting localhost:3030. From your dashboard, you can view network information, assets, and health status alongside action buttons. To activate your watcher, proceed to the 'LOCK' action, where you can utilize assets from the watcher wallet for registration and obtain reporting permits. Top up your wallet with the specified amounts of ERG and RSN to receive these permits.\nAs a watcher, your primary responsibility is to monitor your network and report actions related to the bridge. To report a bridge event, you must have report permits. Acquiring these permits involves two types of payments:\nCollateral: Provide one-time collateral in the form of ERG and RSN tokens to obtain initial report permits. This collateral serves as a security measure to mitigate Sybil attacks. When you return all your report permits, the collateral is refunded, and your watcher is unregistered.\n\n\nRSN for Permits: Lock RSN tokens to receive permit tokens. Use these tokens to create report permits for reporting events. The number of report permits determines how many concurrent reports you can create. In the event of a valid report, the permit is refunded along with your reward. If the report is invalid, the permit is seized as a penalty.\n/// admonition | For tips, troubleshooting, FAQs, and other information, please refer to the main watcher documentation.\n    type: info\n///"
    }
  ],
  "qa_pairs": []
}