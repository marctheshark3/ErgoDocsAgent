{
  "title": "Full Archival Node Technical Workflow",
  "source_url": "docs/node/modes/archive-node-workflow.md",
  "summary": "# Full Archival Node Technical Workflow\n\nThis document outlines the technical workflow for the full archival node mode in Ergo. The process is as follows:\n\n1. Send an **ErgoSyncInfo** message to connected peers. 2. Receive a response with an INV message containing the IDs of blocks that are better than our best block. 3. Request headers for all the block IDs received in step 2.\n\nUpon receiving a header, the following operations are performed:\n\n\n```java\nif(history.apply(header).isSuccess) {\n    if(!isInitialBootstrapping) Broadcast INV for this Header\n    Request transaction ids from this block\n    } else {\n    blacklist peer\n    }\n```\n\n\nWhen transaction IDs from the Header are received, the following operations are performed:\n\n```java\ntransactionIdsForHeader.filter(txId => !MemPool.contains(txId)).foreach",
  "keywords": [
    "archival",
    "node",
    "technical",
    "workflow",
    "document",
    "mode",
    "ergo",
    "process",
    "ergosyncinfo",
    "message",
    "peer",
    "response",
    "block",
    "request",
    "header",
    "step",
    "operation",
    "java",
    "if(history.apply(header).issuccess",
    "if(!isinitialbootstrapping",
    "broadcast",
    "transaction",
    "blacklist",
    "transactionidsforheader.filter(txid",
    "txid",
    "mempool.getheaderswithalltransaction",
    "blocktransactions",
    "goto",
    "neighbour",
    "state",
    "modifier",
    "chain",
    "adproof",
    "todo",
    "interface",
    "scorex",
    "core",
    "adproofs",
    "progress",
    "info",
    "utxosnapshot",
    "ethereum",
    "mining",
    "rollerchain*/",
    "if(\"mode\"=\"full",
    "adproofs.foreach",
    "history.apply(adproof",
    "history",
    "sequence",
    "history.drop(blocktransactions.headerid",
    "information",
    "bootstrapping",
    "section",
    "processing](modifier",
    "processing.md#bootstrapping"
  ],
  "sections": [
    {
      "heading": "Full Archival Node Technical Workflow",
      "content": "This document outlines the technical workflow for the full archival node mode in Ergo. The process is as follows:\nSend an ErgoSyncInfo message to connected peers.\nReceive a response with an INV message containing the IDs of blocks that are better than our best block.\nRequest headers for all the block IDs received in step 2.\nUpon receiving a header, the following operations are performed:\njava\nif(history.apply(header).isSuccess) {\n    if(!isInitialBootstrapping) Broadcast INV for this Header\n    Request transaction ids from this block\n    } else {\n    blacklist peer\n    }\nWhen transaction IDs from the Header are received, the following operations are performed:\njava\ntransactionIdsForHeader.filter(txId => !MemPool.contains(txId)).foreach { txId =>\n    request transaction with txId\n}\nUpon receiving a transaction, the following operations are performed:\njava\nif(Mempool.apply(transaction).isSuccess) {\n    if(!isInitialBootstrapping) Broadcast INV for this transaction\n        Mempool.getHeadersWithAllTransactions { BlockTransactions =>\n            GOTO 7\n    }\n}\nNow we have BlockTransactions: all transactions corresponding to some Header\n```java\nif(History.apply(BlockTransactions) == Success(ProgressInfo)) {\nif(!isInitialBootstrapping) Broadcast INV for BlockTransactions\n\n/*We should notify our neighbours that now we have all the transactions\nState apply modifiers (may be empty for a block in a forked chain)\nand generate ADProofs for them.\nTODO requires a different interface from scorex-core,\nbecause it should return ADProofs\nTODO when minimal state apply Progress info,\nit may also create UTXOSnapshot\n(e.g. every 30000 blocks like in Ethereum).\nThis UTXOSnapshot should be required for mining by Rollerchain*/\n\nif(State().apply(ProgressInfo) == Success((newState, ADProofs))) {\n    if(\"mode\"=\"full\" || \"mode\"==\"pruned-full\") ADProofs.foreach ( ADProof => History.apply(ADProof))\n    if(\"mode\"==\"pruned-full\" || \"mode\"==\"light-full\") drop BlockTransactions and ADProofs older tha..."
    }
  ],
  "qa_pairs": []
}