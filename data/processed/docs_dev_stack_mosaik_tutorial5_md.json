{
  "id": "docs_dev_stack_mosaik_tutorial5_md",
  "title": "Ergo Mosaik: A UI system for Ergo dApps",
  "summary": "The document discusses the Ergo Mosaik, a UI system for Ergo dApps, and covers two main use cases: 1) showing an informational page in web browsers visiting the Mosaik app, and 2) running the Mosaik app within a web browser. It explains how to handle the first use case by moving the Mosaik app to a different URL and serving an HTML page with a hint for Mosaik executors. For the second use case, it introduces the Mosaik web executor, an interactive website that can run Mosaik apps without the need for a browser plugin. The document also covers adding support for the ErgoPay wallet connection in the Mosaik web executor. Finally, it concludes by inviting developers to provide feedback on the Mosaik framework and its development.",
  "qa_pairs": [
    {
      "question": "What are the two use cases discussed in the tutorial?",
      "answer": "{\"1\":\"You only want your Mosaik app to be used from within wallet apps. But you want web browsers visiting your app URL to show a nice site explaining the users to open the app URL from within a wallet app\",\"2\":\"You want your Mosaik app to run within a web browser\"}"
    },
    {
      "question": "How does the tutorial handle the case where the Mosaik app should only be used from within wallet apps?",
      "answer": "The tutorial moves the Mosaik app away from the URL and instead serves HTML content, while leaving a hint for Mosaik executors where to find the actual Mosaik app."
    },
    {
      "question": "What is the purpose of the Mosaik web executor?",
      "answer": "The Mosaik web executor is an interactive website consisting of a single HTML page, a single JS file, and a configuration file that allows running Mosaik apps from within a web browser."
    },
    {
      "question": "What are the limitations of the Mosaik web executor?",
      "answer": "The Mosaik web executor does not support pixel-perfect element positioning or coloring elements in all available colors, as it is designed to behave the same as Mosaik executed in wallet applications."
    },
    {
      "question": "What are the two new API endpoints required for connecting a wallet with ErgoPay in the Mosaik web executor?",
      "answer": "Endpoint A is called continuously by the web executor's connect wallet screen to check if the user already connected, and Endpoint B is an ErgoPay endpoint connected from the wallet app when the user connects, which saves the user's wallet address in a temporary map for Endpoint A to pick up."
    }
  ],
  "sections": [
    {
      "heading": "Ergo Mosaik: A UI system for Ergo dApps",
      "level": 1,
      "content": ""
    },
    {
      "heading": "Part 5: The Web",
      "level": 2,
      "content": "Welcome back to the Ergo Mosaik tutorial series! In the previous parts of this series, we already implemented a full-fledged Mosaik app for sending ERG that is working \nsmoothly when launched in a Mosaik executor like the Ergo Wallet app or the Mosaik desktop debugger. But there are people out there without Mosaik executing wallet apps, \nor people using the app but not being aware that they can use Mosaik dApps within their wallet app, or people preferring to have a clear separation\u2026 long story short, \nwe need to keep care of web browsers, as they are the go-to app for most users to visit an URL or host name.\n\nThis tutorial will show you how to handle two use cases:\n\n\n1. You only want your Mosaik app to be used from within wallet apps. But you want web browsers visiting your app URL to show a nice site explaining the users to open the app URL from within a wallet app\n2. You want your Mosaik app to run within a web browser\n\nLet\u2019s focus on 1) first."
    },
    {
      "heading": "Show an informational page in web browsers visiting your Mosaik app",
      "level": 4,
      "content": "Let\u2019s go back to our tutorial app and start up the Spring Boot process. We know that our Mosaik app is living on [http://localhost:8080/](http://localhost:8080/) now, \nand opening it in the desktop debugger works as great as expected. However, when we open up the app in a web browser\u2026we only get to see the json output that is our \nserialized app. Let\u2019s do this better!\n\nThere is no way in getting web browsers understanding what a Mosaik app is, so we use a simple trick to achieve what we want: We move the Mosaik app away from the URL, \nand instead serve HTML content we want the user to see there. But we leave a hint for Mosaik executors where to find the actual Mosaik app.\n\nMoving the Mosaik app is easy. Let\u2019s open MosaikAppController and change the annotation for getMainPage:\n\n\n```\n@GetMapping(\"/firstapp\")\nfun getMainPage(): MosaikApp {...}\n```\n\n\nWe also need to change the annotation for userEnteredName:\n\n\n```\n@PostMapping(\"/firstapp/enteredName\")\nfun userEnteredName(@RequestBody values: Map<String, Any?>) = \u2026\n```\n\n\nNow we need to define new content for the main page.\n\nCreate a new directory \u201cstatic\u201d in the src/main/resources directory and create a file \u201cnobrowser.html\u201d with the following content:\n\n\n```\n<html>\n<head>\n   <link rel=\"mosaik\" href=\"firstapp\">\n</head>\n<body>\nPlease navigate to this page with a Mosaik executor application.\n</body>\n</html>\n```\n\n\nThis is the content to be served. The important part for Mosaik executors is the link &lt;rel=\u201dMosaik\u201d \u2026> tag, while all other content is for web browsers to show.\n\nWe tell Spring to serve this file for the main page with the following addition to MosaikAppController.kt.\n\n\n```\n@GetMapping(\"/\")\nfun browserHintPage(): ModelAndView {\n   return ModelAndView(\"nobrowser.html\")\n}\n```\n\n\nAnd that\u2019s it! After restarting Spring, web browsers show a hint message when visiting localhost:8080, while Mosaik executors automatically load the linked Mosaik app.\n\nOf course, you don\u2019t need to show an ugly hint message, but can instead serve your main web page here.\n\nYou can find this version of the example app on [https://github.com/MrStahlfelge/mosaik-tutorial-series/tree/2dc2af35eae0592b7f9a1f252353be0585ddd57f](https://github.com/MrStahlfelge/mosaik-tutorial-series/tree/2dc2af35eae0592b7f9a1f252353be0585ddd57f)"
    },
    {
      "heading": "Run your Mosaik app in web browsers",
      "level": 4,
      "content": "Mosaik apps are platform agnostic and can be executed in wallet applications on different operating systems and architectures. There is also a Mosaik executor \navailable to run your apps from within a web browser. It is not a browser plugin, but instead an interactive website consisting only of a single html page, a \nsingle Js file and a configuration file that you host on your web site. The configuration file specifies where the web executor loads your Mosaik app from, so \nyou can reuse your Mosaik apps for the wallet apps here - in most cases without a change.\n\nBefore we do the necessary steps to run our apps with the web executor, some words on what to expect and what it is meant for:\n\nSince Mosaik is platform agnostic and meant to be used for wallet plugins, the Mosaik UI defines certain elements and its placements in a view hierarchy. There \nis no absolute way to define how elements look like, so it is expected that buttons or icons do not look the same when run with another executor. Hence, Mosaik \nwill never support pixel-pefect element positioning or coloring elements in all available colors. If you need this, Mosaik web is not for you, you need to \ndevelop your own web UI.\n\nHowever, Mosaik web is designed to _behave_ the same as Mosaik executed in wallet applications. Your apps will behave the same without a code change on your side, and\nyou can publish your app as a web app with practically no effort regarding web development.\n\nNow let\u2019s start using the web executor. You can find it on its Git repository [https://github.com/MrStahlfelge/mosaik-kt-js](https://github.com/MrStahlfelge/mosaik-kt-js) \nunder releases as a zip file. In most cases, it is not needed that you build it yourself - this is only needed if you need the latest working version, or if you want to \ncustomize the colors. See the README on the repository for infos on this.\n\nDownload the latest zip file. It contains the three files mentioned above. You can host these files on any static web hosting provider so that it integrates well into \nyour existing web presence, or you can use the Spring application that serves the Mosaik app to serve it as well. We go with the latter by dropping the three files \ninto the resources/static directory next to our nobrowser.hml page.\n\nNow do the following changes:\n\n\n\n* Change our method browserHintPage we defined above to serve the index.html file\n* Open the index.html file and add the <code>&lt;<strong>link rel=\"mosaik\" href=\"firstapp\"</strong>> </code>entry to its header section. Do other changes you like to this file (changing title, changing loading screen etc)\n* Open the mosaikconfig.json and change the \u201cstartupurl\u201d entry to \u201cfirstapp\u201d\n* <strong>Make sure all your @RestController annotations are accompanied by a @CrossOrigin annotation</strong>\n\nRestart the Spring process and visit localhost:8080 in your browser will show you the following page:\n\n![Mosaik 1](../../../assets/img/mosaik/tutorial5-1.png)\n\nEnter your name and click \u201cClick me\u201d changes the title label as expected.\n\nBut how can we visit our second app for sending ERG? Sure, we could add a button to our main screen with a navigateToApp action. But Mosaik Web executor has a built-in way to \ndirectly link to certain Mosaik apps by adding \u201croutes\u201d entries in the mosaikconfig.json.\n\nLet\u2019s change the routes entry as follows:\n\n\n```json\n{\n  \"starturl\": \"firstapp\",\n  \"routes\": {\n   \"send\": \"http://127.0.0.1:8080/sendfunds\"\n  }\n}\n```\n\n\nNow you can access and link directly to the sendfunds app with [http://localhost:8080/#send](http://localhost:8080/#send) - this way, navigating between apps automatically \nsupports the browser\u2019s back/forward history functionality.\n\nWhen you visit our send funds app in browser, you may notice that the following features already work:\n\n\n\n* choosing a wallet address manually or by using an installed browser extension wallet\n* send button checks validity of input fields and a dialog opens for the user to scan an ErgoPay QR code or to start an ErgoPay-compatible wallet app\n* mobile support\n\nThe wallet address chooser is even more configurable. You can disable the manual address entry, and you can enable connecting the wallet with ErgoPay. This should be done so \nthat mobile users don\u2019t need to copy their p2pk address manually."
    },
    {
      "heading": "Add ErgoPay connect wallet support",
      "level": 4,
      "content": "Connecting a wallet with ErgoPay needs establishing a channel back from the wallet app to the Mosaik web executor, that\u2019s why you need to add two new API endpoints \nand a data holder service to your Spring controllers and configure these two endpoints in web executor\u2019s mosaikconfig.json.\n\nFor simplicity, the actual code is not shown here as it is some boilerplate. If you read through it, it is pretty easy to understand that it handles the following: \nEndpoint A is called continuously by the web executor\u2019s connect wallet screen to check if the user already connected. Endpoint B is an ErgoPay endpoint connected \nfrom the wallet app when the user connects. It saves the user\u2019s wallet address in a temporary map for endpoint A to pick up.\n\nThe two endpoints are implemented in UserSessionController and the temporary wallet address map is implemented in UserSessionService. Feel free to copy them as is \nin your own project. You can find them here:  \n[https://github.com/MrStahlfelge/mosaik-tutorial-series/tree/fba56d65e8c8a01821ecb1c56037bc5dfa8a652a/src/main/kotlin/com/example/ergomosaik/mosaikapp](https://github.com/MrStahlfelge/mosaik-tutorial-series/tree/fba56d65e8c8a01821ecb1c56037bc5dfa8a652a/src/main/kotlin/com/example/ergomosaik/mosaikapp)\n\nFor the web executor to know where to connect to, the mosaikconfig.json file needs to be edited as follows:\n\n\n```json\n{\n \"starturl\": \"firstapp\",\n \"chooseWalletErgoPay\": {\n   \"getAddressForSessionUrl\": \"http://127.0.0.1:8080/getUserAddress/#RID#\",\n   \"ergoPaySetAddressUrl\": \"ergopay://127.0.0.1:8080/setAddress/#RID#/#P2PK_ADDRESS#\"\n },\n \"routes\": {\n   \"send\": \"http://127.0.0.1:8080/sendfunds\"\n }\n}\n```\n\n\nPlease note: Since we have a local address (127.0.0.1) here, the connection won\u2019t work when using a mobile device to read the QR code. \nIt works when using a local network IP."
    },
    {
      "heading": "Conclusion",
      "level": 4,
      "content": "In the five parts of this tutorial series, you\u2019ve learned what Mosaik is about and how to write Mosaik apps that run as wallet application \nplugins and on the web. Mosaik is still a framework being worked on. To proceed, we need you, the developers, to jump on. What is not working \nwell yet, where do the existing view elements have shortcomings? Give us feedback by DM or on the Ergo discord in #dev-support\n\nHappy coding!"
    }
  ],
  "source": "https://github.com/ergoplatform/ergodocs",
  "file_path": "docs/dev/stack/mosaik/tutorial5.md",
  "processed_at": "2025-05-11T19:36:18.326742",
  "ai_processed": true
}