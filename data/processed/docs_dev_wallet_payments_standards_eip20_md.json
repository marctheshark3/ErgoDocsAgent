{
  "id": "docs_dev_wallet_payments_standards_eip20_md",
  "title": "ErgoPay: A Wallet and dApp Interaction Protocol",
  "summary": "ErgoPay is a standard for interaction between an online dApp and a wallet app to facilitate the creation, signing, and sending of Ergo transactions. The protocol allows the dApp to provide transaction details to the wallet, which the user can then confirm and sign using their private keys. The wallet can then submit the signed transaction to the blockchain and optionally notify the dApp. The document outlines two options for data formats: 1) the dApp provides a URL request for ErgoPaySigningRequest information, or 2) the dApp provides a URI scheme containing a ReducedTransaction. The document also describes the implementation details for both wallet apps and dApps, as well as the benefits of the protocol for both.",
  "qa_pairs": [
    {
      "question": "What is the purpose of the ErgoPay protocol?",
      "answer": "ErgoPay is a standard for cross-platform interaction between an online dApp and a wallet app to facilitate the creation, signing, and sending of Ergo transactions."
    },
    {
      "question": "What are the two options for how a dApp can provide information to a wallet app using ErgoPay?",
      "answer": "Option 1: dApp provides a URL request for ErgoPaySigningRequest information. Option 2: dApp provides a URI scheme containing a ReducedTransaction."
    },
    {
      "question": "What are the benefits of ErgoPay for dApps?",
      "answer": "ErgoPay allows dApps to have full control over creating transactions and spending their own application-specific contract boxes."
    },
    {
      "question": "What are the benefits of ErgoPay for wallets?",
      "answer": "ErgoPay enables wallets to support more complex transactions beyond simple transfers between Pay-To-Public-Key addresses."
    },
    {
      "question": "What is the eUTXO model in Ergo, and how does it relate to the need for ErgoPay?",
      "answer": "In Ergo's eUTXO model, a box can be protected by an arbitrarily complex contract, and a universal wallet application cannot know all the specific details of all possible contracts, hence the need for ErgoPay."
    }
  ],
  "sections": [
    {
      "heading": "Introduction",
      "level": 0,
      "content": "---\ntags:\n  - EIP\n---"
    },
    {
      "heading": "ErgoPay: A Wallet and dApp Interaction Protocol",
      "level": 1,
      "content": "> \ud83d\udd17 Refer to [EIP-0020](https://raw.githubusercontent.com/ergoplatform/eips/master/eip-0020.md) for more details.\n\n\n* Author: @aslesarenko, @MrStahlfelge\n* Status: Proposed\n* Created: 18-August-2021"
    },
    {
      "heading": "Table of Contents",
      "level": 2,
      "content": "- [ErgoPay: A Wallet and dApp Interaction Protocol](#ergopay-a-wallet-and-dapp-interaction-protocol)\n  - [Table of Contents](#table-of-contents)\n  - [Overview](#overview)\n  - [Background and Motivation](#background-and-motivation)\n  - [ErgoPay Interaction Protocol](#ergopay-interaction-protocol)\n  - [Data Formats](#data-formats)\n    - [Option 1: dApp Provides URL Request for ErgoPaySigningRequest Information](#option-1-dapp-provides-url-request-for-ergopaysigningrequest-information)\n      - [Response: ErgoPaySigningRequest](#response-ergopaysigningrequest)\n    - [Option 2: dApp Provides URI Scheme Containing ReducedTransaction](#option-2-dapp-provides-uri-scheme-containing-reducedtransaction)\n  - [Wallet App Implementation](#wallet-app-implementation)\n  - [dApp Implementation](#dapp-implementation)\n  - [Benefits for dApps](#benefits-for-dapps)\n  - [Benefits for Wallets](#benefits-for-wallets)"
    },
    {
      "heading": "Overview",
      "level": 2,
      "content": "ErgoPay is a standard for cross-platform interaction between an online dApp and a wallet app. It facilitates the creation, signing, and sending of Ergo transactions."
    },
    {
      "heading": "Background and Motivation",
      "level": 2,
      "content": "Cryptocurrency wallets, such as the [Ergo Android Wallet](https://github.com/ergoplatform/ergo-wallet-android), typically support scanning QR codes of [Payment Requests](https://explorer.ergoplatform.com/payment-request?address=9er9hxmVcL8S4bNypCyJHpPEEkAfEd9CLq5gNrHN6s2pYomp55N&amount=0&description=) or intercepting a link with a special [URI scheme](https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki). After parsing a payment request, the wallet can build a new transaction, sign it using a secret key stored locally on the device, and then send it to the blockchain.\n\nHowever, this is only possible for simple transactions, such as transferring ERGs and assets between Pay-To-Public-Key addresses or transactions that only spend boxes from P2PK addresses.\n\nIn Ergo's eUTXO model, a box can be protected by an arbitrarily complex contract (aka spending condition), and any spending transaction should satisfy that condition by adding required context variables, creating an expected number of outputs with specific [registers](registers.md) depending on the contract. A universal wallet application cannot know all the specific details of all possible contracts.\n\nOn the other hand, every Ergo dApp is usually built on top of specific contracts. The business logic of the dApp includes spending of the boxes protected by those application-specific contracts. In other words, any dApp is in full control of creating transactions and thus can spend its own contracts without the above-mentioned problems. However, the dApp cannot sign those transactions, because signing requires knowledge of private keys which are not stored on the dApp, but instead stored on the wallet app.\n\nTherefore, an interaction between a dApp and a wallet is required such that:\n\n1. The dApp builds a transaction and makes it available for the wallet application.\n2. The wallet app shows a confirmation screen to the user, displaying the inboxes and outboxes it is going to sign.\n3. When the user confirms, the wallet app signs the transaction and submits it to the blockchain or returns it back to the dApp.\n4. The dApp monitors the transaction on the blockchain and upon confirmations, proceeds with its business logic.\n\nOne possible implementation of such an interaction scheme is described in [EIP-0012](https://github.com/ergoplatform/eips/pull/23). However, it is only suitable for in-browser wallets, which can interact with dApps via JavaScript code injected into a web context.\n\nFortunately, the design of Ergo contracts allows for a simple and universal implementation suitable for mobile or desktop wallets. This EIP describes the interaction protocol and the reference implementation.\n\nThe main question in this 3-step process is: \"How can the transaction built in the dApp be transferred to the wallet application so that it can be signed there?\"."
    },
    {
      "heading": "ErgoPay Interaction Protocol",
      "level": 2,
      "content": "An ErgoPay interaction between a Wallet and a dApp is driven by the dApp's user and proceeds as follows:\n\n1. The user enters the necessary information in the dApp's UI and proceeds to a payment screen. Optionally, the dApp can request the user's P2PK address with an extra step using a signing request with a placeholder URL (see below).\n\n2. The payment screen shows transaction details and a QR code as well as a clickable link.\n\n3. The user clicks the link to hand the information over to a wallet application on the same device, or scans the QR code using a wallet application.\n\n4. The Wallet application parses the QR code data and obtains either `ErgoPaySigningRequest` or `ReducedTransaction` data (see [Data Formats](#data-formats) section). In the former case, the QR code data contains a URL to download `ErgoPaySigningRequest` from the dApp.\n\n5. When `ErgoPaySigningRequest` or `ReducedTransaction` is obtained, it is shown as a payment screen on the wallet app containing the same transaction details as the dApp screen.\n\n6. The user compares the dApp's screen, the Wallet's screen, and the transaction details and confirms the payment by using a \"Sign\" button. If the Wallet also supports [EIP-0019](eip19.md) and private keys are not available, then the sign button behaves like a \"Cold Sign\" button according to EIP-0019.\n\n7. The wallet application signs the transaction either using local private keys or using a Cold Wallet and EIP-0019 protocol. The result of signing is `SignedTransaction` data.\n\n8. The Wallet obtains the transaction id and sends it to the dApp using `ErgoPayTransactionSent` API post message to `replyToUrl` if the URL is provided. If successful, the wallet then submits `SignedTransaction` to the blockchain. If the URL is not provided, then the wallet submits the transaction to the blockchain without notifying the dApp. The dApp can monitor the blockchain by txId which it can learn from UnsignedTransaction. This is based on the fact that `UnsignedTransaction.id == SignedTransaction.id` holds for all transactions.\n\n9. The dApp monitors the transaction by id and proceeds with its business logic upon receiving enough confirmations. This concludes the ErgoPay protocol.\n\nAdditional requirements: \n\n- Multiple instances of the ErgoPay protocol MUST be able to run simultaneously within the dApp.\n- The Wallet MAY implement \"one-at-a-time\" signing. When the signing is interrupted for some reason, it can be started from step 3 (i.e., scanning the QR).\n- When the dApp receives the transaction id, but the `SignedTransaction` is not accepted to the blockchain, then the dApp SHOULD detect this situation and stop monitoring that transaction."
    },
    {
      "heading": "Data Formats",
      "level": 2,
      "content": "The data formats of this EIP are based on a new binary data structure and serialization format called `ReducedTransaction`, which is described in [EIP-0019](eip19.md).\n\nBelow we describe the data formats specified by this EIP and refer to the formats defined in EIP-0019.\n\nWallet apps should be able to initiate ErgoPay both by using URI schemes (clickable links) or QR codes."
    },
    {
      "heading": "Option 1: dApp Provides URL Request for ErgoPaySigningRequest Information",
      "level": 3,
      "content": "`ergopay://<URL>`\n\nThe URL is provided without the https prefix. HTTP communication is not allowed except for IP addresses (for testing within a local network).\n\nThe provided URL can contain a `#P2PK_ADDRESS#` placeholder. The wallet application will replace this placeholder with an actual P2PK address.\n\nExamples:\n\n* `ergopay://sigmausd.io/signingRequest/2001-16b8-66c4-b800-6e52-8ce4` will make the wallet app request `https://sigmausd.io/signingRequest/2001-16b8-66c4-b800-6e52-8ce4`.\n* `ergopay://192.168.0.1/html` will make the wallet app request `http://192.168.0.1/html`.\n* `ergopay://auctionhouse.org/bid/#P2PK_ADDRESS#` will make the wallet app request `ergopay://auctionhouse.org/bid/3Wx7Z8FywaL4ofunDCV1NaTJX5CpjTubMrjpCkEhnNBAgJLGfRcD`."
    },
    {
      "heading": "Response: ErgoPaySigningRequest",
      "level": 4,
      "content": "The wallet application should request the URL and obtain the following data (in JSON format):\n\n```\nErgoPaySigningRequest:\n  - transaction: ReducedTransaction (optional*)\n  - address: String (optional)\n  - message: String (optional*)\n  - messageSeverity: String (optional) \"INFORMATION\", \"WARNING\", \"ERROR\"\n  - replyToUrl: String (optional)\n```\n\nEither a **transaction** or a **message** must be provided, otherwise the request is invalid.\n\nThe wallet application should show the **message** and display the **messageSeverity** in a suitable way, if provided.\n\nIf **transaction** details are obtained, a payment screen opens for the user to confirm signing the transaction. Transaction details CAN BE OPTIONALLY shown on the payment screen of the wallet application.\n\nIf **address** is provided by the dApp, the wallet can preselect the key the user needs to sign the transaction.\n\nAfter signing is performed and the `SignedTransaction` data is obtained, the wallet can POST the following data to the dApp using **replyToUrl** from the signing request (in JSON format) if it is provided.\n\n```\nErgoPayTransactionId:\n  - txId: String\n```\n\ndApps should not rely on this request to be made. It could happen that the transaction was submitted to a node, but the reply couldn't be executed. dApps know the transaction id and should monitor the mempool and blockchain on their own.\n\nIn case no **transaction** was provided, the wallet app displays the **message** that should inform the user about further steps needed."
    },
    {
      "heading": "Option 2: dApp Provides URI Scheme Containing ReducedTransaction",
      "level": 3,
      "content": "When the dApp does not need to use an extra request, the `ReducedTransaction` could also be encoded in the QR code or link:\n\n`ergopay:<ReducedTransaction, base 64 url safe encoded>`\n\nIt is not possible to provide **description**, **address**, **message**, and **replyToUrl** in this simpler interchange format.\n\ndApp developers should keep in mind that there are length restrictions for URI schemes and QR codes. Both should be able to handle up to 2900 chars, but QR codes with a lot of content need to be shown bigger to be read without problems.\n\nWe recommend using a URL request if the payload exceeds 400 chars."
    },
    {
      "heading": "Wallet App Implementation",
      "level": 2,
      "content": "[Ergo Wallet App 1.6 or higher](https://github.com/ergoplatform/ergo-wallet-app)"
    },
    {
      "heading": "dApp Implementation",
      "level": 2,
      "content": "[ErgoPay showcase example](https://github.com/MrStahlfelge/ergopay-server-example)"
    },
    {
      "heading": "Benefits for dApps",
      "level": 2,
      "content": "ErgoPay provides a fast, easy, and secure way for users to buy goods and services in a dApp or on a website. When supported, ErgoPay can substantially increase checkout conversion rates, user loyalty and purchase frequency, and reduce checkout time.\n\n- dApp or website don\u2019t need to handle user's secrets (mnemonic/private keys). Instead, once the user has signed the transaction to confirm purchase intent, your app or website receives a transaction id to monitor payment status on the blockchain.\n- dApp's users don't need to worry about the security of their private keys as the wallet app guarantees they never leave the device.\n- ErgoPay EIP is compatible with Cold Wallet EIP, thus users can use Cold Wallet devices to sign transactions within the ErgoPay signing process.\n- Adding ErgoPay to product detail pages, the cart, checkout page, in payment settings, or anywhere else a user can choose ErgoPay as the payment method or initiate a purchase.\n- The payment screen can be presented immediately after the user taps the Ergo Pay button, without any interim screens or pop-ups except to prompt for necessary product details, such as size or quantity.\n- ErgoPay is simple and universal. It supports all smart contracts and offers the flexibility to implement simple to complex dApps."
    },
    {
      "heading": "Benefits for Wallets",
      "level": 2,
      "content": "Any wallet application team should consider supporting ErgoPay in their wallet along with basic wallet features. Users can participate in Ergo dApps and the wallet team can receive service fees from those transactions."
    }
  ],
  "source": "https://github.com/ergoplatform/ergodocs",
  "file_path": "docs/dev/wallet/payments/standards/eip20.md",
  "processed_at": "2025-05-11T19:41:12.445940",
  "ai_processed": true
}