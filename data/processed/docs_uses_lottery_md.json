{
  "id": "docs_uses_lottery_md",
  "title": "Background",
  "summary": "The document discusses the concept of \"proof of activity\" as a smart contract, which aims to incentivize members for running a full node. The primary method behind both proof of stake and proof of activity is \"follow-the-satoshi\", which selects a random satoshi from all the generated ones, and the holder of that satoshi becomes eligible for the reward.\n\nThe focus of the post is on replicating the follow-the-satoshi protocol to establish a provably fair lottery system, similar to a physical lottery where tickets are sold in sequential serial numbers, and the winner is determined by a random number generated between 0 and the last unsold serial number.\n\nThe document outlines how this lottery system can be emulated using Ergo, where a \"lottery box\" contains tokens and the current available serial number, and a \"purchase box\" stores the start and end serial numbers of purchased tokens. After the lottery concludes, the winner is determined using randomness from the previous block header.",
  "qa_pairs": [
    {
      "question": "What is the primary objective of 'proof of activity'?",
      "answer": "To incentivize members for their 'activity', which refers to running a full node."
    },
    {
      "question": "What is the fundamental method behind both proof of stake and proof of activity?",
      "answer": "Follow-the-satoshi, which selects a random satoshi from all the generated ones, and the holder of that satoshi becomes eligible for the reward."
    },
    {
      "question": "What are the key steps in the physical lottery system that the post aims to replicate?",
      "answer": "1. Generate lottery tickets with sequential serial numbers, 2. Sell tickets in sequential serial number order, 3. Record the first unsold serial number n, 4. Generate a random number r between 0 and n-1, 5. Declare the holder of the ticket with serial number r as the winner."
    },
    {
      "question": "How does the Ergo-based lottery system work?",
      "answer": "The lottery owner creates a 'lottery box' that contains tokens and the current available serial number in R4, protected by a script that sells tokens and stores the remaining tokens in an identical box with the serial number incremented. The purchased tokens are stored in a 'purchase box' that contains the start and end serial numbers in R4 and R5, locked to prevent the buyer from altering them."
    },
    {
      "question": "What is the relationship between the Ergo-based lottery system and the COMET project?",
      "answer": "The lottery system described in the post is similar to the lottery system currently live in the COMET project."
    }
  ],
  "sections": [
    {
      "heading": "Background",
      "level": 1,
      "content": "The concept discussed in this post is inspired by the idea of [Proof-of-Activity as a Smart Contract](https://www.ergoforum.org/t/proof-of-activity-as-a-smart-contract/132).\n\nThe primary objective of \"proof of activity\" is to incentivize members for their \"activity\", which in this context refers to running a full node.\n\nThe underlying approach is essentially based on \"proof-of-stake\". This means that active participants receive larger rewards than those who hold a similar stake but are inactive. The aim is to deter individuals from holding a stake without actively contributing to the network.\n\nThe fundamental method behind both proof of stake and proof of activity is *follow-the-satoshi*. This method selects a random satoshi from all the generated ones, and the holder of that satoshi becomes eligible for the reward. If the satoshi is selected uniformly, this process resembles a lottery system."
    },
    {
      "heading": "The Lottery",
      "level": 1,
      "content": "The focus of this post is not on proof of stake or proof of activity. Instead, it is about replicating the follow-the-satoshi protocol to establish a provably fair lottery system. It's worth noting that a similar lottery system is currently live in the COMET project.\n\nThe lottery system we aim to create will mimic the following physical lottery:\n\n1. A company generates lottery tickets with sequential serial numbers.\n2. There is a single location to purchase the tickets.\n3. Tickets can only be bought in sequential serial numbers using the \"next available serial number\" rule (starting from serial number 0).\n4. Once the lottery is closed (meaning no more tickets can be sold), the first unsold serial number ***n*** is recorded.\n5. A random number ***r*** is generated between 0 and ***n***-1 (both inclusive).\n6. The holder of the ticket with serial number ***r*** is declared the winner.\n\nThis can be emulated with Ergo as follows:\n\nThe lottery owner creates a \"lottery box\" that contains tokens and the current available serial number in **R4**. This box is protected by a script that sells tokens, and the remaining tokens are stored in an identical box with the serial number incremented accordingly.Moreover, the purchased tokens are stored in a \"purchase box\" that contains the start and end serial numbers of purchased tokens in **R4** and **R5** respectively. We also require the script in the purchase box to \"lock\" these values, preventing the buyer from altering them.\n\nAfter the lottery concludes, the last serial number ***n*** is stored in **R4** of the lottery box. Using this, the winner is determined by, for example, using randomness from the previous block header to generate a number uniformly between 0 and ***n***. The winner can then use their purchase box to claim the rewards.\n\nThe rewards can be stored in the lottery box itself, and each ticket purchased contributes to the reward. \n\nWhile this system operates fairly, it is not deterministic as it depends on the last block header.\n\nSince each \"previous block\" determines a different winner for the same ***n***, this can also be used as a proof of activity because the current winner must be online.\n\nFor a comprehensive discussion, refer to [this thread](https://www.ergoforum.org/t/a-lottery-on-top-of-ergo/137)."
    }
  ],
  "source": "https://github.com/ergoplatform/ergodocs",
  "file_path": "docs/uses/lottery.md",
  "processed_at": "2025-05-11T20:03:01.765283",
  "ai_processed": true
}